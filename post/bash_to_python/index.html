<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="OWicca"><meta name=generator content="Hugo 0.121.2"><title>Bash to Python â€” Down the wabbit's hole</title>
<meta name=description content><link rel=canonical href=https://www.dinudev.com/post/bash_to_python/><link href rel=alternate type=application/rss+xml title="Down the wabbit's hole"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Arvo:400,700"><link rel=stylesheet href=https://www.dinudev.com/css/highlight.css><link rel=stylesheet href=https://www.dinudev.com/css/paperback.css><link rel=stylesheet href=https://www.dinudev.com/css/main.css><link rel=stylesheet href=https://www.dinudev.com/css/tabs.css></head><body><div class=container><header><h1>Bash to Python</h1><nav class=site-nav><a href=/>Home</a>
<a href=/post/>All posts</a>
<a href=/thoughts/>Thoughts</a>
<a href=/paper/>Papers</a></nav></header><h3>Table of Contents</h3><aside><nav id=TableOfContents><ul><li><ul><li><a href=#topics>Topics:</a></li><li><a href=#when-to-python-instead-of-bash>when to python instead of bash:</a></li><li><a href=#when-to-use-bash-instead-of-python>when to use bash instead of python:</a></li></ul></li></ul></nav></aside><article><h3 id=topics>Topics:</h3><ol><li>reading and writing files:</li></ol><ul><li>cli reads files line-by-line and does some action to that line</li><li>when processing stdin data, cli expects a stream of text divided by newline(file-like object)</li><li><code>open</code>:<ul><li>file path</li><li>mode:<ul><li><code>r</code>: read only</li><li><code>w</code>/<code>w+</code>: write only</li><li><code>a</code>/<code>a+</code>: append</li></ul></li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;/file/path.txt&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> f:
</span></span><span style=display:flex><span>		print(line<span style=color:#f92672>.</span>strip())
</span></span></code></pre></div><ol start=2><li>cli interfaces:</li></ol><ul><li>handling piping(<code>stdin</code>, <code>stdout</code>, <code>stderr</code>)</li><li>stdin</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> sys<span style=color:#f92672>.</span>stdin:
</span></span><span style=display:flex><span>	print(line)
</span></span></code></pre></div><ul><li>stdout: <code>print</code> / <code>sys.stdout.write('Out\n')</code></li><li>stderr: <code>sys.stderr.write('Error\n')</code></li><li>cli arguments: <code>sys.argv[1:]</code> or much more expressive <code>argparse</code> library</li><li>environment variables: <code>os.environ['HOME']</code></li></ul><ol start=3><li>fs:</li></ol><ul><li>paths <a href=https://docs.python.org/3/library/pathlib.html#basic-use><code>pathlib.Path</code></a>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pathlib
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> Path(<span style=color:#e6db74>&#39;/etc&#39;</span>)
</span></span><span style=display:flex><span>third <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;3.tar.gz&#39;</span>
</span></span><span style=display:flex><span>print(p <span style=color:#f92672>/</span> <span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>/</span> third) <span style=color:#75715e># PosixPath(&#39;/etc/2/3.tar.gz&#39;)</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> p <span style=color:#f92672>/</span> <span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>/</span> third
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>parts) <span style=color:#75715e># gets array of parts: (&#39;/&#39;, &#39;etc&#39;, &#39;2&#39;, &#39;3.tar.gz&#39;)</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>drive) <span style=color:#75715e># get drive if any: &#39;&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>root) <span style=color:#75715e># &#39;/&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>parents[<span style=color:#ae81ff>0</span>]) <span style=color:#75715e># &#39;/etc/2&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>parents[<span style=color:#ae81ff>1</span>]) <span style=color:#75715e># &#39;/etc/&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>parents[<span style=color:#ae81ff>2</span>]) <span style=color:#75715e># &#39;/&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>name) <span style=color:#75715e># &#39;3.tar.gz&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>stem) <span style=color:#75715e># &#39;3&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>suffix) <span style=color:#75715e># &#39;.tar.gz&#39;</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>suffixes) <span style=color:#75715e># [&#39;.tar&#39;, &#39;.gz&#39;]</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span>is_absolute()) <span style=color:#75715e># check if absolute path: boolean</span>
</span></span><span style=display:flex><span>print(p<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(<span style=color:#f92672>&lt;</span>glob<span style=color:#f92672>-</span>like pattern<span style=color:#f92672>&gt;</span>)) <span style=color:#75715e># check if pattern matches path: boolean</span>
</span></span></code></pre></div><ul><li>various file operations: <a href=https://docs.python.org/3/library/shutil.html><code>shutil</code></a>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> shutil
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>archive_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;file.tar&#34;</span>
</span></span><span style=display:flex><span>src <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/file1.txt&#34;</span>
</span></span><span style=display:flex><span>dst <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/file2.txt&#34;</span>
</span></span><span style=display:flex><span>dr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/home/&#34;</span>
</span></span><span style=display:flex><span>dstDir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>copyfile(src, dst) <span style=color:#75715e># copy src to dst file</span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>copy(src, dr) <span style=color:#75715e># copy src file to dr dir, doesn&#39;t copy metadata</span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>copy2(src, dr) <span style=color:#75715e># copy src file to dr dir, with metadata</span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>copytree(dr, dstDir) <span style=color:#75715e># copy dir dr to dir dstDir</span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>rmtree(dr) <span style=color:#75715e># equivalent of `rm -rf ${dr}`</span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>mv(dr, dstDir) <span style=color:#75715e># move file/dir dr to location dstDir</span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>chown(src, user<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>, group<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>) <span style=color:#75715e># chmod</span>
</span></span><span style=display:flex><span>archived_path <span style=color:#f92672>=</span> shutil<span style=color:#f92672>.</span>make_archive(archive_name, <span style=color:#e6db74>&#39;gztar&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, src) <span style=color:#75715e># arhive a file based on a specified format(formats can be displayed with `shutil.get_archive_formats()`)</span>
</span></span><span style=display:flex><span>shutil<span style=color:#f92672>.</span>unpack_archive(archived_path, dstDir, <span style=color:#e6db74>&#39;gztar&#39;</span>) <span style=color:#75715e># unpack archive to dstDir based on format</span>
</span></span></code></pre></div><ol start=4><li>replacing <code>sed</code>, <code>awk</code>, <code>grep</code> with regexp <a href=https://docs.python.org/3/library/re.html><code>re</code></a>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(\d</span><span style=color:#e6db74>{2}</span><span style=color:#e6db74>)&#34;</span>
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;123&#34;</span>
</span></span><span style=display:flex><span>replacement <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;!!!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;a&#34;</span> <span style=color:#f92672>in</span> s) <span style=color:#75715e># bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prog <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(pattern)
</span></span><span style=display:flex><span>s_res <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(prog, s) <span style=color:#75715e># return `None` if no position in the string matches the pattern</span>
</span></span><span style=display:flex><span>m_res <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(prog, s)
</span></span><span style=display:flex><span>fm_res <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>fullmatch(prog, s)
</span></span><span style=display:flex><span>split_res <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>split(prog, s)
</span></span><span style=display:flex><span>findall_res <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(prog, s)
</span></span><span style=display:flex><span>sub_res <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>sub(prog, replacement, s)<span style=color:#75715e># return string `s` with pattern `prog` replaced by `replacement`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>s_res<span style=color:#f92672>.</span>groups() <span style=color:#75715e># get touple of groups</span>
</span></span><span style=display:flex><span>s_res<span style=color:#f92672>.</span>groups(n) <span style=color:#75715e># reference n-th matched group</span>
</span></span><span style=display:flex><span>s_res<span style=color:#f92672>.</span>expand(<span style=color:#e6db74>&#34;!-&gt;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>1&lt;-!&#34;</span>) <span style=color:#75715e># based on template, replace &#34;\&lt;n&gt;&#34;, &#34;\g&lt;n&gt;&#34;, &#34;\g&lt;name&gt;&#34;: &#34;!-&gt;12&lt;-!&#34;</span>
</span></span><span style=display:flex><span>s_res<span style=color:#f92672>.</span>groupdict()<span style=color:#75715e># return a dict with named groups and their matches</span>
</span></span></code></pre></div><ol start=5><li>running processes with <a href=https://docs.python.org/3/library/subprocess.html><code>subprocess</code></a></li><li>misc:</li></ol><ul><li>time: <code>import time, datetime</code></li><li>web requests: <a href=https://docs.python-requests.org/en/latest/><code>requests</code></a></li><li>quote bash scripts: <code>shlex.quote</code></li></ul><h3 id=when-to-python-instead-of-bash>when to python instead of bash:</h3><ul><li>if bash scripts is longer than 50 lines</li><li>if you ever type &ldquo;IFS=&rdquo;</li><li>if you need to use arrays</li></ul><h3 id=when-to-use-bash-instead-of-python>when to use bash instead of python:</h3><ul><li>when you need to orchestrate processes</li><li>when you need to pipe inputs/outputs between processes</li><li>for quick oneliners</li></ul></article><nav class=site-nav><a href=https://www.dinudev.com//>Home</a>
<a href=https://www.dinudev.com//post/>All posts</a>
<a href=https://www.dinudev.com//thoughts/>Thoughts</a>
<a href=https://www.dinudev.com//paper/>Papers</a>
<a href=https://github.com/Owicca>GitHub</a></nav><footer class=site-footer><span class=owner>Â©2024 OWicca</span></footer></div><script src=https://www.dinudev.com/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://www.dinudev.com/js/tabs.js></script></body></html>