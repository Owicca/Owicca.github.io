<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="OWicca"><meta name=generator content="Hugo 0.80.0"><title>Red Hat — Down the wabbit's hole</title><meta name=description content><link rel=canonical href=https://www.dinudev.com/post/rh/><link href rel=alternate type=application/rss+xml title="Down the wabbit's hole"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Arvo:400,700"><link rel=stylesheet href=https://www.dinudev.com/css/highlight.css><link rel=stylesheet href=https://www.dinudev.com/css/paperback.css><link rel=stylesheet href=https://www.dinudev.com/css/main.css></head><body><div class=container><header><h1>Red Hat</h1><nav class=site-nav><a href=/>Home</a>
<a href=/post/>All posts</a>
<a href=/paper/>Papers</a></nav></header><article><h3 id=virtual-machines-and-automated-installations>Virtual machines and automated installations:</h3><ul><li>what is kvm(kernel-based virtual machine)?<ul><li>a kernel module that allows compatible processors to run vms()</li><li>each vm is a regular process</li><li>each vm has dedicated virtual hardware</li></ul></li><li>how do you configure it on a fresh install?:<ul><li>install:<ul><li><code># yum install "Virtualization Host" "Virtualization Client"</code>:<ul><li>qemu-kvm: main kvm package</li><li>libvirt: hypervisor manager as a daemon</li><li>libvirt-client: <code>virsh</code> and the API that controls vms</li><li>virt-install</li><li>virt-manager: GUI <code>virsh</code></li><li>virt-top</li><li>virt-viewer: GUI to connect to vm consoles</li></ul></li><li>check for kernel modules:<ul><li><code># lsmod | grep kvm</code>:<ul><li><code>kvm_intel kvm</code></li><li><code>kvm_amd kvm</code></li></ul></li><li>if not enabled <code># modprobe kvm_intel</code> or <code># modeprobe kvm_amd</code></li></ul></li><li>enable if not enabled</li><li>change images location:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mkdir &lt;path/to/folder&gt;
$ su - root
<span style=color:#75715e># semanage fcontext -a -t virt_image_t &#39;&lt;path/to/folder&gt;(/.*)?&#39;</span>
<span style=color:#75715e># restorecon &lt;path/to/folder&gt;</span>
<span style=color:#75715e># rmdir /var/lib/libvirt/images</span>
<span style=color:#75715e># ln -s &lt;path/to/folder&gt; /var/lib/libvirt/images</span></code></pre></div></li></ul></li><li>how to create a vm?:<ul><li>install: with <code>virt-install</code></li><li>access vm console:<ul><li>use virt-manager&rsquo;s virt-viewer or configure a vnc/spice on the vm and connect with an external virt-viewer</li></ul></li><li>start/stop: <code>virsh start &lt;domain></code> / <code>virsh destroy &lt;domain></code></li><li>launch vm at boot:<ul><li><code>--autostart</code> in virt-install</li><li><code>virsh autostart &lt;domain></code></li></ul></li></ul></li><li>how to automate the installation of a vm?<ul><li>kickstart:<ul><li>a config file on a http/ftp accesible host</li><li>a http/ftp accesible .iso or mounted image</li></ul></li><li>a config file of the succesful install is /root/anaconda-ks.cfg</li></ul></li></ul></li><li>generic cli tools that you need thoughrouly understand:<ul><li><code>scp</code></li><li><code>grep</code></li><li><code>find</code></li><li><code>ps</code></li><li><code>ssh</code></li><li><code>sudo</code></li><li><code>kill</code></li><li><code>sed</code></li><li><code>awk</code><ul><li><code>nmap</code></li></ul></li></ul></li></ul><h3 id=documentation>Documentation:</h3><ul><li>documentation is saved in &ldquo;/usr/share/doc&rdquo;</li><li>index is a database that holds records for:<ul><li><code>whatis</code> descriptions</li><li>man page locations</li></ul></li><li>apropos and whatis use a database in /var/cache/man:<ul><li>is updated daily</li><li>to force an update <code>/etc/cron.daily/man-db.cron</code></li></ul></li><li>commands:<ul><li><code>apropos</code>: search for a keyword in the man db and return all pages that contain it</li><li><code>whatis</code>: show a short description of a command</li><li><code>man</code>: open the manual page of a particular command</li><li><code>info</code>:<ul><li>information manuals(a small number of them, but very extensive)</li><li>location is in &ldquo;/usr/share/info&rdquo;</li></ul></li></ul></li></ul><h3 id=networking>Networking:</h3><table><thead><tr><th style=text-align:right>old</th><th style=text-align:right>new</th><th style=text-align:right>description</th></tr></thead><tbody><tr><td style=text-align:right>ifconfig</td><td style=text-align:right>ip link / ip addr</td><td style=text-align:right>address information for all network interfaces</td></tr><tr><td style=text-align:right>arp</td><td style=text-align:right>ip neigh</td><td style=text-align:right>show arp table</td></tr><tr><td style=text-align:right>route / netstat -r</td><td style=text-align:right>ip route</td><td style=text-align:right>routing table</td></tr><tr><td style=text-align:right>netstat -npltu</td><td style=text-align:right>ss -npltu</td><td style=text-align:right>sockets and the programs they belong to</td></tr></tbody></table><ul><li><code>arp</code>, <code>ifconfig</code>, <code>netstat</code>, <code>route</code> have been deprecated in favor of <code>ip</code></li><li>temporary changes with the use of <code>ip</code>, but persistence is achieved with the files in &ldquo;/etc/sysconfig/network-scripts&rdquo;</li><li>main host network configuration files:<ul><li>&ldquo;/etc/hosts&rdquo;: a static map of domains and their ips</li><li>&ldquo;/etc/resolv.conf&rdquo;: a static map of dns domains and their ips</li><li>&ldquo;/etc/hostname&rdquo;: contains the hosts hostname</li><li>&ldquo;/etc/nsswitch.conf&rdquo;: configure the order in which the host will look up a domain</li></ul></li></ul><h3 id=security>Security:</h3><ul><li>DAC(discretionary access control):<ul><li>file/dir permissions:<ul><li>r:<ul><li>file: read file</li><li>dir: list dir files</li></ul></li><li>w:<ul><li>file: write file</li><li>dir: create/delete dir files</li></ul></li><li>x:<ul><li>file: execute file</li><li>dir: access dir files</li></ul></li><li>format: 1234567890:<ul><li>1:<ul><li><code>-</code>: regular file</li><li><code>d</code>: directory</li><li><code>b</code>: device</li><li><code>l</code>: link</li></ul></li><li>234: owner</li><li>567: group</li><li>890: other</li></ul></li><li>special permissions:<ul><li>SUID(super user ID; s/S in execute bit for the user):<ul><li>file: when executed the process&rsquo;s effective uid is the uid of the file</li><li>dir: nothing</li><li><code>S</code> if only SUID is set; <code>s</code> if SUID and <code>x</code> are set</li></ul></li><li>GUID(super group ID; s/S in execute bit for group):<ul><li>file: when executed the process&rsquo;s effective gid is the gid of the file</li><li>dir: when files are created, give them the group id of the dir</li><li><code>S</code> if only SUID is set; <code>s</code> if GUID and <code>x</code> are set</li></ul></li><li>sticky bit(t/T in execute bit for others):<ul><li>file: nothing</li><li>dir: files can be renamed or deleted only by their owners</li><li><code>T</code> if only SUID is set; <code>t</code> if sticky bit and <code>x</code> are set</li></ul></li></ul></li><li>selinux:<ul><li><code>ls -l</code>: a dot after the permissions</li></ul></li><li>acl:<ul><li><code>ls -l</code>: a + after permissions</li><li>work only on ext4, xfs and nfs(v4)</li><li>acl option must be active on mount</li><li>from rhel 7 acl is active by default on xfs, ext2, ext3, ext4</li></ul></li><li>attributes:<ul><li>lsattr: to display attributes</li><li>chattr: to add/set/remove attributes</li><li>values:<ul><li>a: prevents deletion, append only</li><li>d: can&rsquo;t use <code>dump</code> on file</li><li>e: used on ext4 fs</li><li>i: prevents any change of the file</li></ul></li></ul></li><li>gotchas:<ul><li>w on dir allows to delete and write again a file,
irre of the w bit on the file&rsquo;s permissions</li></ul></li></ul></li><li>file/dir ownership:<ul><li>only root can change the owner of a file</li><li>the owner of a file can change the file&rsquo;s group</li></ul></li></ul></li><li>ACL(access control lists):<ul><li>override and extend DAC permissions</li></ul></li><li>firewall:<ul><li>cli: <code>firewall-cmd</code></li><li>gui: <code>firewall-config</code></li><li>firewalld is an abstraction over iptables(LEARN IPTABLES)</li></ul></li><li>MAC(mandatory access control):<ul><li>Security-Enhanced Linux(SELinux) :<ul><li>to install:<ul><li><code>policycoreutils</code> or <code>policycoreutils-python</code></li><li><code>setroubleshoot</code></li><li><code>setools</code></li></ul></li><li>enable selinux: <code>setenforce</code></li><li>modify global settings: <code>semanage</code>:<ul><li>manage relations between se user and os users: <code>semanage login</code></li><li>modify se policy: <code>semanage fcontext</code></li></ul></li><li>modify booleans: <code>getsebool</code> / <code>setsebool</code></li><li>set file se user, se role, se type, se level: <code>chcon</code></li><li>restore file context to the default in the selinux policy: <code>restorecon</code></li></ul></li></ul></li></ul><h3 id=logging>Logging:</h3><ul><li><code>/var/log/secure</code>: sessions?!</li><li><code>/var/log/audit</code>: audit logs</li><li><code>journalctl</code>: logs from startup saved in ram</li><li>to make systemd logging persistent:<ul><li><code>mkdir /var/log/journal</code></li><li><code>chgrp systemd-journal /var/log/journal</code></li><li><code>chmod 2775 /var/log/journal</code></li><li><code>systemctl restart systemd-journald.service</code></li></ul></li></ul><h3 id=boot>Boot:</h3><ul><li>boot process:<ol><li>BIOS/UEFI does some hardware tests the points to a media device:<ul><li>POST(power on self test)</li></ul></li><li>if the device contains and MBR or GPT(GUID partition table),
that table points to a GRUB2 bootloader</li><li>in GRUB2 you choose a option to boot to(usually an OS)</li><li>the options is a set of commands that initialize the linux kernel</li><li>the linux kernel starts systemd(first process)</li><li>systemd starts/manages a target</li><li>a target is a set of units(processes, services, daemons)</li></ol></li><li>targets:<ul><li>graphical.target: usual gui boot</li><li>multi-user.target: headles server boot</li><li>rescue.target: ?!</li><li>emergency.target:<ul><li>lower-level than rescue.target</li><li>only /root is mounted as ro</li></ul></li></ul></li><li>problems while booting an OS?:<ul><li>in bootloader, after kernel16, add:<ul><li>systemd.unit=rescue.target: mount everything as usual(?!?!) and ask for root password
OR</li><li>systemd.unit=emergency.target: mount /root as RO and ask for root password
OR</li><li>init=/sysroot/binsh: mount /root as RO, already logged as root</li><li>rd.break: mount /root as RO, already logged as root</li></ul></li></ul></li><li>reset root password:<ul><li>when loading os, enter bootloader and add rd.break at the end of linux16 line</li><li><code>mount -o remount,rw /sysroot</code></li><li><code>chroot /sysroot</code></li><li><code>passwd</code></li><li><code>touch /.autorelabel</code></li><li>exit and exit again to reboot</li></ul></li><li>/boot/grub2/grub.cfg:<ul><li>linux16: path and settings of kernel</li><li>initrd16: path and settings of RAM disk fs</li><li>edit <code>/etc/default/grub.cfg</code> and/or files in <code>/etc/grub.d/</code> then <code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></li></ul></li><li>/etc/default/grub.cfg:<ul><li>GRUB_TIMEOUT: number of seconds before the default option is chosen for you(if 0 the list of oses will not show)</li><li>GRUB_DEFAULT:<ul><li>saved=saved_entry variable in <code>/boot/grub2/grubenv</code></li><li>update saved_entry with <code>grub2-set-default N</code>: N starts from 0</li></ul></li><li>GRUB_DISABLE_RECOVERY: disable recovery entries in list</li><li>GRUB_CMDLINE_LINUX: list of options for linux kernel</li></ul></li><li><code>yum install/reinstall grub2-tools</code></li></ul><h3 id=systemd-units>Systemd Units:</h3><ul><li>each unit is a cgroup</li><li>units are files defined in:<ul><li><code>/etc/systemd/system/</code></li><li><code>/usr/lib/systemd/system/</code>(do not change these, software updates overwrite them)</li></ul></li></ul><h6 id=use-parted>use parted:</h6><ol><li>mklabel on a disk</li><li>create/modify/delete partition</li></ol><h6 id=delete-partition-in-parted>delete partition in parted:</h6><ol><li>save data from partition</li><li>unmount partition</li><li>remove from /etc/fstab</li><li>delete from parted</li></ol><h6 id=lvm-management>lvm management:</h6><ul><li>entities:<ul><li>PV(physical volume)</li><li>VG(volume group)</li><li>LV(logical volume)</li></ul></li><li>concepts:<ol><li>register formated partitions as PVs</li><li>create VGs and add PVs to VGs</li><li>from available VGs create LVs</li></ol></li></ul><h6 id=etcfstab>/etc/fstab:</h6><ul><li>do not reference fs by device name(/dev/sdb2), but by UUID;
UUIDs are unique for each partition, while device names can change,
because they are based on initialization order of the disks on boot</li><li>line format:<ul><li>field 1: device partition name/UUID</li><li>field 2: directory mount point</li><li>field 3: fs name</li><li>field 4: mount options</li><li>field 5: dump value(0 or 1), if you backup a fs by <code>dump</code></li><li>field 6: <code>fsck</code> priority on boot:<ul><li>1 for <code>/</code></li><li>2 for other mounts</li><li>0 for removable fs(cd/dvd/usb; 0 = it is not checked)</li></ul></li></ul></li><li>teste fstab changes:<ul><li><code>mount -o remount,ro &lt;device partition name/UUID></code></li></ul></li><li>important mount options:<ul><li>dev/nodev: allow/disallow usage of character device files on fs</li><li>sync/async: all I/O is done synchronously/async on this fs</li><li>atime/noatime: update/do not update inode access time every time the file is accessed</li><li>auto/noauto: can/can not be used with <code>mount -a</code></li><li>exec/noexec: allow/dissalow binaries to be run on this fs</li><li>suid/nosuid: allow/dissalow <code>setuid</code>/<code>setgid</code> usage on this fs</li><li>ro: mount fs as read-only</li><li>rw: mount fs as read-write</li><li>user/nouser: allow/dissalow non-root users to mount this fs(this also sets noexec,nosuid,nodev)</li><li>defaults: alias for <code>rw,suid,dev,exec,auto,nouser,async</code></li></ul></li><li>how to mount removable media:<ul><li><code>mount -t iso9660 /dev/&lt;name> &lt;/directory/to/mount/media></code></li></ul></li><li>mount shared disks:<ul><li>nfs:<ul><li>cli: <code>mount -t nfs domain.name.com:/path/to/dir /local/path/to/dir</code></li><li>fstab: <code>domain.name.com:/path/to/dir /local/path/to/dir nfs rsize=65536,wsize=65536,hard,udp 0 0</code><ul><li>rsize: max read size on every request</li><li>wsize: max write size on every request</li><li>hard: if connection failed, retry indefinitely</li><li>soft: try a number of times then abort(might lose data)</li><li>udp: use udp</li><li>tcp: use tcp</li></ul></li></ul></li><li>samba:<ul><li>fstab:<ul><li><code>//domain.name.com/path/to/dir /local/path/to/dir cifs rw,username=user,password=pass, 0 0</code></li></ul></li><li>fstab with hidden credentials:<ul><li><code>//domain.name.com/path/to/dir /local/path/to/dir cifs rw,credentials=/etc/secret, 0 0</code></li><li><code>/etc/secret</code>:<ul><li><code>password=pass</code></li><li><code>username=user</code></li><li>can only be read by root</li></ul></li></ul></li></ul></li></ul></li></ul><h3 id=virtual-fs>Virtual fs:</h3><ul><li><code>tmps</code>: in memory fs that uses RAM and swap space</li><li><code>devpts</code>: pseudo-terminal devices</li><li><code>sysfs</code>: <code>/sys</code> that holds real-time system related information</li><li><code>proc</code>: <code>/proc</code> newer and cleaner version of <code>/sys</code></li><li><code>cgroups</code>: related to controlling groups of processes</li></ul></article><nav class=site-nav><a href=https://www.dinudev.com//>Home</a>
<a href=https://www.dinudev.com//post/>All posts</a>
<a href=https://www.dinudev.com//paper/>Papers</a>
<a href=https://github.com/Owicca>GitHub</a></nav><footer class=site-footer><span class=owner>©2021 OWicca</span></footer></div><script src=https://www.dinudev.com/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>