<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="OWicca"><meta name=generator content="Hugo 0.102.3"><title>WrapLogin — Down the wabbit's hole</title><meta name=description content><link rel=canonical href=https://www.dinudev.com/journey/wraplogin/><link href rel=alternate type=application/rss+xml title="Down the wabbit's hole"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Arvo:400,700"><link rel=stylesheet href=https://www.dinudev.com/css/highlight.css><link rel=stylesheet href=https://www.dinudev.com/css/paperback.css><link rel=stylesheet href=https://www.dinudev.com/css/main.css></head><link rel=stylesheet href=https://www.dinudev.com/css/tabs.css><body><div class=container><header><h1>WrapLogin</h1><nav class=site-nav><a href=/>Home</a>
<a href=/post/>All posts</a>
<a href=/journey/>The journey</a>
<a href=/paper/>Papers</a></nav></header><h3>Table of Contents</h3><aside><nav id=TableOfContents><ul><li><ul><li><a href=#flow>flow:</a></li><li><a href=#imports>imports:</a></li><li><a href=#exports>exports:</a></li><li><a href=#strings>strings:</a></li><li><a href=#re>re:</a></li></ul></li></ul></nav></aside><article><h3 id=flow>flow:</h3><ul><li>setup a signal handler h for signum n:<ul><li>n = 14d = SIGALRM</li><li>h = <code>connection</code></li></ul></li><li><code>connection</code>:<ul><li><code>execv("/bin/.login", *app_list_of_arguments[])</code></li><li><code>exit(0)</code></li></ul></li><li>schedule a n seconds signal alarm:<ul><li>n = 1d</li></ul></li><li><code>alarm(1)</code><ul><li>emulate &ldquo;/bin/login&rdquo; by asking a password from the user</li></ul></li><li>if password == &ldquo;door&rdquo;:<ul><li><code>alarm(0)</code></li><li><code>execl("/bin/sh", "/bin/sh", "-i")</code></li><li><code>exit(0)</code></li></ul></li><li>else:<ul><li><code>execv("/bin/.login", *app_list_of_arguments[])</code></li><li><code>exit(0)</code></li></ul></li></ul><h3 id=imports>imports:</h3><ul><li>execl</li><li>execv</li><li>strcmp</li><li>signal</li><li>scanf</li><li>alarm</li></ul><h3 id=exports>exports:</h3><ul><li>execute</li><li>connection</li><li>passwd</li></ul><h3 id=strings>strings:</h3><ul><li>/bin/login</li><li>door</li><li>/bin/sh</li><li>/bin/.login</li><li>/export/home/gb.local/rpm/BUILD/glibc-2.3.1/build-i586-linux/csu/crti.S</li><li>/export/home/gb.local/rpm/BUILD/glibc-2.3.1/csu</li><li>GNU AS 2.13.90.0.18</li><li>/export/home/gb.local/rpm/BUILD/glibc-2.3.1/build-i586-linux/csu/crtn.S</li><li>/export/home/gb.local/rpm/BUILD/glibc-2.3.1/csu</li><li>GNU AS 2.13.90.0.18</li><li>init.c</li><li>../sysdeps/generic/bits/types.h</li><li>../wcsmbs/wchar.h</li><li>/usr/lib/gcc-lib/i586-mandrake-linux-gnu/3.2.2/include/stddef.h</li><li>../sysdeps/gnu/_G_config.h</li><li>../iconv/gconv.h</li><li>/export/home/gb.local/rpm/BUILD/glibc-2.3.1/build-i586-linux/csu/crti.S</li><li>dd,,-:</li><li>/export/home/gb.local/rpm/BUILD/glibc-2.3.1/build-i586-linux/csu/crtn.S</li></ul><h3 id=re>re:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> global_argv[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>argv[]) {
</span></span><span style=display:flex><span>	signal(SIGALRM, connection);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	alarm(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>	global_argv <span style=color:#f92672>=</span> argv;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>char</span> passwd[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	scanf(<span style=color:#e6db74>&#34;%s&#34;</span>, <span style=color:#f92672>&amp;</span>passwd);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(passwd <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;door&#34;</span>) {
</span></span><span style=display:flex><span>		alarm(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>		execl(<span style=color:#e6db74>&#34;/bin/sh&#34;</span>, <span style=color:#e6db74>&#34;/bin/sh&#34;</span>, <span style=color:#e6db74>&#34;-i&#34;</span>);
</span></span><span style=display:flex><span>		exit(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		execv(<span style=color:#e6db74>&#34;/bin/.login&#34;</span>, global_argv);
</span></span><span style=display:flex><span>		exit(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sighandler_t <span style=color:#a6e22e>connection</span>() {
</span></span><span style=display:flex><span>	execv(<span style=color:#e6db74>&#34;/bin/.login&#34;</span>, global_argv);
</span></span><span style=display:flex><span>	exit(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div></article><nav class=site-nav><a href=https://www.dinudev.com//>Home</a>
<a href=https://www.dinudev.com//post/>All posts</a>
<a href=https://www.dinudev.com//journey/>The journey</a>
<a href=https://www.dinudev.com//paper/>Papers</a>
<a href=https://github.com/Owicca>GitHub</a></nav><footer class=site-footer><span class=owner>©2022 OWicca</span></footer></div><script src=https://www.dinudev.com/js/highlight.pack.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>